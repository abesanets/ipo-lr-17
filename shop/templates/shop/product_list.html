{% extends 'shop/base.html' %}

{% block title %}Каталог — Магазин электроники{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'index' %}">Главная</a> → Каталог
</div>

<h1>Каталог товаров</h1>

<!-- Фильтры и поиск -->
<form method="get" class="filters">
    <div class="filter-group">
        <label>Поиск</label>
        <input type="text" name="search" value="{{ search_query }}" placeholder="Название товара...">
    </div>

    <div class="filter-group">
        <label>Категория</label>
        <select name="category">
            <option value="">Все категории</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" {% if selected_category == cat.id|stringformat:"d" %}selected{% endif %}>
                    {{ cat.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-group">
        <label>Производитель</label>
        <select name="manufacturer">
            <option value="">Все производители</option>
            {% for man in manufacturers %}
                <option value="{{ man.id }}" {% if selected_manufacturer == man.id|stringformat:"d" %}selected{% endif %}>
                    {{ man.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-group">
        <label>Цена от</label>
        <input type="number" name="price_min" value="{{ price_min }}" placeholder="0" style="width: 100px;">
    </div>

    <div class="filter-group">
        <label>Цена до</label>
        <input type="number" name="price_max" value="{{ price_max }}" placeholder="999999" style="width: 100px;">
    </div>

    <div class="filter-group">
        <label>Сортировка</label>
        <select name="sort">
            <option value="name" {% if sort == 'name' %}selected{% endif %}>По названию (А-Я)</option>
            <option value="-name" {% if sort == '-name' %}selected{% endif %}>По названию (Я-А)</option>
            <option value="price" {% if sort == 'price' %}selected{% endif %}>По цене (↑)</option>
            <option value="-price" {% if sort == '-price' %}selected{% endif %}>По цене (↓)</option>
            <option value="-stock" {% if sort == '-stock' %}selected{% endif %}>По наличию</option>
        </select>
    </div>

    <button type="submit">Найти</button>
    <a href="{% url 'product_list' %}"><button type="button" class="reset">Сбросить</button></a>
</form>

<p class="results-count">Найдено товаров: {{ products|length }}</p>

<!-- Сетка товаров -->
<div class="products-grid">
    {% for product in products %}
        <div class="product-card">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}">
            {% else %}
                <div class="no-image">Нет фото</div>
            {% endif %}
            <div class="info">
                <div class="category">{{ product.category.name }}</div>
                <h3><a href="{% url 'product_detail' product.id %}">{{ product.name }}</a></h3>
                <div class="manufacturer">{{ product.manufacturer.name }} ({{ product.manufacturer.country }})</div>
                <div class="price">{{ product.price }} ₽</div>
                {% if product.stock > 0 %}
                    <div class="stock">В наличии: {{ product.stock }} шт.</div>
                {% else %}
                    <div class="stock out">Нет в наличии</div>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <p>Товары не найдены.</p>
    {% endfor %}
</div>
{% endblock %}